{% extends 'admin/base.html.twig' %}

{% block title %}Signalements en attente - Administration
{% endblock %}

{% block admin_content %}
	<div class="min-h-screen bg-main py-8">
		<div class="container-medium">
			{% include "partials/_messages.html.twig" %}

			<div class="mb-8">
				<div class="flex items-center space-x-4">
					<a href="{{ path('app_admin_report') }}" class="link-nav inline-flex items-center space-x-2">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
						</svg>
						<span>Retour</span>
					</a>
					<h1 class="text-4xl font-bold text-gray-900">Signalements en attente</h1>
				</div>
				<p class="text-gray-600 mt-2">
					{{ count }}
					signalement{{ count > 1 ? 's' : '' }}
					attendant votre examen
				</p>
			</div>

			{% if reports|length > 0 %}
				<div class="grid grid-cols-1 gap-6">
					{% for report in reports %}
						<div
							class="card card-padded border-l-4 border-yellow-500">

							{# Header carte #}
							<div class="flex items-start justify-between mb-6">
								<div>
									<h3 class="text-xl font-bold text-gray-900">
										Signalement sur
										{{ report.people.lastname|upper }}
										{{ report.people.name }}
									</h3>
									<p class="text-sm text-gray-500 mt-1">
										Signalé le
										{{ report.createdAt|date('d/m/Y à H:i') }}
									</p>
								</div>
								<span class="badge-warning">En attente</span>
							</div>

							{# 1 - Informations sur le signalant #}
							<div class="bg-purple-50 rounded-lg p-4 mb-4">
								<p class="text-sm font-semibold text-gray-700 mb-2">Signalé par</p>
								<div class="flex items-center space-x-3">
									<div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-blue-400 flex items-center justify-center text-white font-bold">
										{{ report.user.name|slice(0, 1)|upper }}
									</div>
									<div>
										<p class="font-semibold text-gray-900">
											{{ report.user.name }}
											{{ report.user.lastname }}
										</p>
										<p class="text-sm text-gray-600">
											{{ report.user.email }}
										</p>
									</div>
								</div>
							</div>

							{# 2 - Type de signalement #}
							<div class="bg-blue-50 rounded-lg p-4 mb-4">
								<p class="text-sm font-semibold text-gray-700 mb-2">Type de signalement</p>
								<p class="text-lg font-bold text-blue-600">{{ report.typeReport.label }}</p>
							</div>

							{# Raison du signalement #}
							<div class="mb-4">
								<p class="text-sm font-semibold text-gray-700 mb-2">Motif du signalement</p>
								<div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
									<p class="text-gray-900">{{ report.content }}</p>
								</div>
							</div>

							{# Actions #}
							<div class="pt-6 border-t border-gray-200 flex items-center space-x-4">
								<a href="{{ path('app_admin_report_show', {id: report.id}) }}" class="btn-secondary flex-1 text-center">
									Voir les détails complets
								</a>

								<form method="POST" action="{{ path('app_admin_report_approve', {id: report.id}) }}" class="flex-1" onsubmit="return confirm('Approuver ce signalement ?');">
									<input type="hidden" name="_token" value="{{ csrf_token('approve' ~ report.id) }}">
									<button type="submit" class="btn-primary w-full inline-flex items-center justify-center">
										<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
										</svg>
										Approuver
									</button>
								</form>

								<form method="POST" action="{{ path('app_admin_report_reject', {id: report.id}) }}" class="flex-1" onsubmit="return confirm('Rejeter ce signalement ?');">
									<input type="hidden" name="_token" value="{{ csrf_token('reject' ~ report.id) }}">
									<button type="submit" class="btn-danger w-full inline-flex items-center justify-center">
										<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
										</svg>
										Rejeter
									</button>
								</form>
							</div>

						</div>
					{% endfor %}
				</div>
			{% else %}
				<div class="card card-padded text-center py-12">
					<svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
					</svg>
					<h3 class="text-xl font-semibold text-gray-900 mb-2">
						Aucun signalement en attente
					</h3>
					<p class="text-gray-600">
						Tous les signalements ont été traités ! Bien joué !
					</p>
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}
