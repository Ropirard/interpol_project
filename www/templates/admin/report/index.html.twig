{% extends 'admin/base.html.twig' %}

{% block title %}Signalements - Administration
{% endblock %}

{% block admin_content %}
	<div class="min-h-screen bg-gray-50 py-10">
		<div class="max-w-7xl mx-auto px-6">

			{% include "partials/_messages.html.twig" %}

			<!-- HEADER -->
			<div class="flex flex-col md:flex-row md:items-center md:justify-between mb-10">
				<div>
					<h1 class="text-3xl font-bold text-gray-900 tracking-tight">
						Gestion des signalements
					</h1>
					<p class="text-gray-500 mt-1">
						Examinez et traitez les signalements des utilisateurs
					</p>
				</div>

				<a href="{{ path('app_admin_report_pending') }}" class="mt-4 md:mt-0 inline-flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white px-5 py-2.5 rounded-xl font-medium shadow-sm transition">
					<span>Voir les signalements en attente</span>
					<span class="bg-white/20 px-2 py-0.5 rounded-md text-sm">
						{{ statsByStatus.pending }}
					</span>
				</a>
			</div>

			<!-- STATS -->
			<div
				class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">

				<!-- En attente -->
				<div class="bg-white text-white rounded-2xl shadow-md p-6 border-b-4 border-yellow-500">
					<p class="text-sm font-medium text-gray-600">En attente</p>
					<div class="flex items-center justify-between mt-3">
						<p class="text-3xl font-bold text-yellow-500">
							{{ statsByStatus.pending }}
						</p>
						<svg class="w-12 h-12 text-yellow-300 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
					</div>
				</div>

				<!-- Approuvés -->
				<div class="bg-white text-white rounded-2xl shadow-md p-6 border-b-4 border-success">
					<p class="text-sm font-medium text-gray-600">Approuvés</p>
					<div class="flex items-center justify-between mt-3">
						<p class="text-3xl font-bold text-green-500">
							{{ statsByStatus.approved }}
						</p>
						<svg class="w-12 h-12 text-green-300 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
					</div>
				</div>

				<!-- Rejetés -->
				<div class="bg-white text-white rounded-2xl shadow-md p-6 border-b-4 border-error">
					<p class="text-sm font-medium text-gray-600">Rejetés</p>
					<div class="flex items-center justify-between mt-3">
						<p class="text-3xl font-bold text-red-500">
							{{ statsByStatus.rejected }}
						</p>
						<svg class="w-12 h-12 text-red-300 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l-2-2m0 0l-2-2m2 2l2-2m-2 2l-2 2"></path>
						</svg>
					</div>
				</div>

				<!-- Total -->
				<div class="bg-white text-white rounded-2xl shadow-md p-6 border-b-4 border-primary">
					<p class="text-sm font-medium text-gray-600">Total</p>
					<div class="flex items-center justify-between mt-3">
						<p class="text-3xl font-bold text-primary">
							{{ statsByStatus.total }}
						</p>
						<svg class="w-12 h-12 text-blue-300 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
						</svg>
					</div>
				</div>

			</div>

			<!-- FILTRES -->
			<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
				<form method="get" class="flex flex-col md:flex-row gap-4">
					<input type="text" name="search" value="{{ search }}" placeholder="Rechercher par pseudo ou email..." class="form-input">
					<select name="filter" class="form-select">
						<option value="all" {{ filter == 'all' ? 'selected' : '' }}>Tous</option>
						<option value="en cours" {{ filter == 'en cours' ? 'selected' : '' }}>En cours</option>
						<option value="approuvé" {{ filter == 'approuvé' ? 'selected' : '' }}>Approuvés</option>
						<option value="rejecté" {{ filter == 'rejecté' ? 'selected' : '' }}>Rejetés</option>
						<option value="fermé" {{ filter == 'fermé' ? 'selected' : '' }}>Fermés</option>
					</select>

					<button type="submit" class="btn-primary">Rechercher</button>
					<a href="{{ path('app_admin_user') }}" class="btn-secondary">Réinitialiser</a>
				</form>
			</div>

			<!-- TABLE -->
			<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
				<div class="overflow-x-auto">
					<table class="w-full text-sm">

						<thead class="bg-gray-50 border-b border-gray-200 text-gray-600 uppercase text-xs tracking-wider">
							<tr>
								<th class="px-6 py-4 text-left">Date</th>
								<th class="px-6 py-4 text-left">Statut</th>
								<th class="px-6 py-4 text-left">Contenu</th>
								<th class="px-6 py-4 text-left">Motif</th>
								<th class="px-6 py-4 text-left">Signalé par</th>
								<th class="px-6 py-4 text-left">Type</th>
								<th class="px-6 py-4 text-right">Action</th>
							</tr>
						</thead>

						<tbody class="divide-y divide-gray-100">

							{% if reports|length > 0 %}
								{% for report in reports %}
									<tr class="hover:bg-gray-50 transition">

										<td class="px-6 py-4 text-gray-500">
											{{ report.createdAt|date('d/m/Y') }}
											<div class="text-xs text-gray-400">
												{{ report.createdAt|date('H:i') }}
											</div>
										</td>

										<td class="px-6 py-4">
											{% if report.statut == 'en cours' %}
												<span class="badge-category-sm font-medium bg-yellow-100 text-yellow-700 rounded-full">
													En attente
												</span>
											{% elseif report.statut == 'approuvé' %}
												<span class="badge-category-sm  font-medium bg-success-light text-successrounded-full">
													Approuvé
												</span>
											{% elseif report.statut == 'rejecté' %}
												<span class=" badge-category-sm font-medium bg-error-light text-error rounded-full">
													Rejeté
												</span>
											{% else %}
												<span class="badge-category-sm font-medium bg-accent-light text-accent rounded-full">
													Fermé
												</span>
											{% endif %}
										</td>

										<td class="px-6 py-4 font-medium text-gray-900">
											{{ report.people.lastname|upper }}
											{{ report.people.name }}
											<div class="text-xs text-gray-400">
												ID#{{ report.people.id }}
											</div>
										</td>

										<td class="px-6 py-4 text-gray-600 max-w-xs truncate">
											{{ report.typeReport.label }}
										</td>

										<td class="px-6 py-4">
											<div class="font-medium text-gray-900">
												{{ report.user.lastname|upper }}
												{{ report.user.name }}
											</div>
											<div class="text-xs text-gray-400">
												{{ report.user.email }}
											</div>
										</td>

										<td class="px-6 py-4">
											<span class="px-3 py-1 text-xs font-medium bg-indigo-100 text-indigo-700 rounded-full">
												{{ report.people.type }}
											</span>
										</td>

										<td class="px-6 py-4 text-right">
											<a href="{{ path('app_admin_report_show', {id: report.id }) }}" class="text-blue-600 hover:text-blue-800 font-medium">
												Voir →
											</a>
										</td>

									</tr>
								{% endfor %}
							{% else %}
								<tr>
									<td colspan="7" class="text-center py-12 text-gray-400">
										Aucun signalement trouvé
									</td>
								</tr>
							{% endif %}

						</tbody>
					</table>
				</div>
			</div>

		</div>
	</div>
{% endblock %}
