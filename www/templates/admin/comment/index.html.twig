{% extends 'admin/base.html.twig' %}

{% block title %}Commentaires - Administration
{% endblock %}

{% block admin_content %}
	<div class="mb-8">
		<h1 class="text-4xl text-gray-900 mb-2">Gestion des commentaires</h1>
		<p class="text-gray-600">Gérez les commentaires de la plateforme</p>
	</div>

	<!-- Recherche -->
	<div class="card-padded mb-6">
		<form method="get" class="flex gap-4">
			<input type="text" name="search" value="{{ search }}" placeholder="Rechercher dans les commentaires..." class="form-input flex-1">
			<button type="submit" class="btn-primary">Rechercher</button>
			<a href="{{ path('app_admin_comment') }}" class="btn-secondary">Réinitialiser</a>
		</form>
	</div>

	<!-- Liste des commentaires -->
	<div class="card-padded">
		{% if comments|length > 0 %}
			<div class="space-y-4">
				{% for comment in comments %}
					<div class="border border-gray-200 rounded-lg p-6 hover:bg-gray-50">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<div class="flex items-center gap-3 mb-2">
									<h3 class="text-lg text-gray-900">
										<a href="{{ path('app_article_show', {id: comment.article.id}) }}" class="hover:underline" target="_blank">
											{{ comment.article.title }}
										</a>
									</h3>
									{% if comment.parentComment %}
										<span class="badge-category-sm">Réponse</span>
									{% endif %}
								</div>

								{% if comment.parentComment %}
									<div class="mb-4 p-4 bg-linear-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-lg shadow-sm">
										<div class="flex items-start gap-3">
											<div class="text-amber-600 mt-1">
												<svg class="w-5 h-5" fill="currentColor" viewbox="0 0 20 20">
													<path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5z"></path>
												</svg>
											</div>
											<div class="flex-1 min-w-0">
												<p class="text-sm font-semibold text-amber-900 mb-2">Message d'origine de
													<span class="text-amber-700">{{ comment.parentComment.user.name }}</span>
												</p>
												<p class="text-sm text-gray-700 whitespace-pre-line line-clamp-3 italic">{{ comment.parentComment.content }}</p>
											</div>
										</div>
									</div>
									<div class="ml-6 pl-4 border-l-4 border-blue-400 bg-blue-50 p-4 rounded-lg">
										<p class="text-xs text-blue-600 font-semibold mb-2">↳ Réponse</p>
										<p class="text-gray-700 mb-3 whitespace-pre-line">{{ comment.content }}</p>
									</div>
								{% else %}
									<p class="text-gray-700 mb-3 whitespace-pre-line">{{ comment.content }}</p>
								{% endif %}
							</div>
							{% if comment.parentComment %}
								<div class="flex items-center gap-4 text-sm text-gray-500 mt-2">
									<span>Par
										{{ comment.user.name }}</span>
									<span>{{ comment.createdAt|date('d/m/Y à H:i') }}</span>
								</div>
							{% else %}
								<div class="flex items-center gap-4 text-sm text-gray-500">
									<span>Par
										{{ comment.user.name }}</span>
									<span>{{ comment.createdAt|date('d/m/Y à H:i') }}</span>
								</div>
							{% endif %}
						</div>
						<div class="ml-4">
							<form method="post" action="{{ path('app_admin_comment_delete', {id:comment.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce commentaire ?');" class="inline">
								<input type="hidden" name="_token" value="{{ csrf_token('delete_comment_' ~ comment.id) }}">
								<button type="submit" class="btn-danger text-sm">Supprimer</button>
							</form>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% else %}
		<p class="text-center text-gray-600 py-8">Aucun commentaire trouvé</p>
	{% endif %}
</div>{% endblock %}