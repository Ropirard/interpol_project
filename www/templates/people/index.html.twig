{% extends "base.html.twig" %}

{% block title %}Interpol | {{ type == 'criminel' ? 'Recherchés' : 'Disparus' }}
{% endblock %}

{% block body %}
	{# Configuration basée sur le type #}
	{% set isCriminal = type == 'criminel' %}

	<div class="min-h-screen bg-main pt-0 pb-8">
		{% include 'partials/choice_navbar.html.twig' %}
		<div class="container-main">
			{% include 'partials/_messages.html.twig' %}
		</div>
		<div class="container-main">
			<!-- En-tête -->
			<div class="mb-8 text-center">
				<h1 class="text-4xl text-gray-900 mb-2">{{ isCriminal ? 'Personnes recherchées' : 'Personnes disparues' }}</h1>
				<p class="text-gray-600">Si vous avez des informations les concernant, merci de nous contacter.</p>
			</div>
		</div>

		<!-- Systeme de tri et filtre + Liste des personnes -->
		<div class="w-full pt-12">
			<div class="flex flex-col lg:flex-row gap-8 items-start">
				<div class="card-sm p-8 mb-8 mt-6 max-w-md w-full ml-0 mr-auto text-left">
					<form method="get" action="{{ path('app_people_index', {type: type}) }}">
						<h1 class="text-2xl text-gray-900 mb-6 mt-6 text-center">Critères de filtres</h1>
						{# contenu filtre #}
						{# Recherche par nom et prénom #}
						<label for="name" class="form-label">Prénom</label>
						<input type="text" name="name" id="name" class="form-input" value="{{ selectedName }}" placeholder="Prénom...">

						<label for="lastname" class="form-label mt-6">Nom</label>
						<div class="flex gap-2">
							<input type="text" name="lastname" id="lastname" class="form-input flex-1" value="{{ selectedLastname }}" placeholder="Nom de famille...">
						</div>

						<label for="gender" class="form-label mt-6">Sexe</label>
						<select name="gender" id="gender" class="form-select" onchange="this.form.submit()">
							<option value="" {{ selectedGender is empty ? 'selected' : '' }}>Tous</option>
							{% for gender in genders %}
								<option value="{{ gender.id }}" {{ selectedGender == gender.id ? 'selected' : '' }}>{{ gender.label }}</option>
							{% endfor %}
						</select>

						<label for="skinColor" class="form-label mt-6">Couleur de peau</label>
						<select name="skinColor" id="skinColor" class="form-select" onchange="this.form.submit()">
							<option value="" {{ selectedSkinColor is empty ? 'selected' : '' }}>Tous</option>
							{% for skinColor in skinColors %}
								<option value="{{ skinColor.id }}" {{ selectedSkinColor == skinColor.id ? 'selected' : '' }}>{{ skinColor.label }}</option>
							{% endfor %}
						</select>

						<label for="nationality" class="form-label mt-6">Nationalité</label>
						<select name="nationality" id="nationality" class="form-select" onchange="this.form.submit()">
							<option value="" {{ selectedNationality is empty ? 'selected' : '' }}>Toutes</option>
							{% for nationality in nationalities %}
								<option value="{{ nationality.id }}" {{ selectedNationality == nationality.id ? 'selected' : '' }}>{{ nationality.label }}</option>
							{% endfor %}
						</select>

						<label class="form-label mt-6">Tranche d'âge</label>
						<div class="flex items-center gap-2">
							<input type="number" name="minAge" id="minAge" min="0" max="120" class="form-input flex-1" value="{{ selectedMinAge }}" placeholder="Min" onchange="this.form.submit()">
							<span class="text-gray-600">à</span>
							<input type="number" name="maxAge" id="maxAge" min="0" max="120" class="form-input flex-1" value="{{ selectedMaxAge }}" placeholder="Max" onchange="this.form.submit()">
						</div>

						{# Filtre Recherché par / Dernière position #}
						<label for="researchBy" class="form-label mt-6">
							{{ isCriminal ? 'Recherché par' : 'Dernière position' }}
						</label>
						<div class="flex gap-2">
							<input type="text" name="researchBy" id="researchBy" class="form-input flex-1" value="{{ selectedResearchBy }}" placeholder="{{ isCriminal ? 'FBI, Interpol...' : 'Paris, New York...' }}">
						</div>

						{# Boutons d'action #}
						<div class="mt-6 flex items-center gap-4">
							<button type="submit" class="btn-primary">Rechercher</button>
							{% set hasFilters = selectedName is not empty or selectedLastname is not empty or selectedNationality is not empty or selectedMinAge is not empty or selectedMaxAge is not empty or selectedGender is not empty or selectedSkinColor is not empty or selectedResearchBy is not empty %}
							{% if hasFilters %}
								<a href="{{ path('app_people_index', {type: type}) }}" class="px-4 py-2 transition-colors link-nav">Réinitialiser</a>
							{% endif %}
						</div>
					</form>
				</div>

				<div class="w-full">
					{% if peoples|length > 0 %}
						<div class="grid grid-cols-1 mb:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3">
							{% for people in peoples %}
								<div class="card-hover overflow-hidden flex flex-col max-w-xs">
									<!-- Image -->
									<a class="block" href="{{ path('app_people_show', {type: type, id: people.id}) }}">
										{% if people.media|length > 0 %}
											<img class="w-full h-48 object-cover" src="{{ people.media.first.path }}" alt="{{ people.lastname }} {{ people.name }}">
										{% else %}
											<img class="w-full h-48 object-cover" src="{{ asset('images/nopicture.png') }}" alt="{{ people.lastname }} {{ people.name }}">
										{% endif %}
									</a>

									<!-- Contenu de la carte -->
									<div class="p-6 flex flex-col flex-1">
										<!-- Nom et prénom + âge + Pays de naissance -->
										<h3 class="text-xl text-gray-900 mb-2">
											<a class="link-nav transition-all duration-200 hover:underline" href="{{ path('app_people_show', {type: type, id: people.id}) }}">
												{{ people.lastname }} {{ people.name }}
											</a>
											<p>{{ people.birthDate|date('d/m/Y') }}</p>
											<p>{{ people.birthPlace ?? '—' }}</p>
										</h3>

										{# Label selon le type #}
										<div class="flex items-center justify-between pt-4 border-t border-gray-200">
											<div class="flex items-center">
												<span class="text-sm text-gray-700">
													{{ isCriminal ? 'Recherché par' : 'Dernière position' }} : {{ people.researchBy }}
												</span>
											</div>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					{% else %}
						{# Message si aucune personne #}
						<div class="card-sm p-12 text-center">
							<svg class="w-16 h-16 text-gray-400 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewbox="0 0 24 24">
								<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M9 16c.85-.63 1.885-1 3-1s2.15.37 3 1m-5.5-5.5V10m5 .5V10"/><path d="M3 18.562v-6.518C3 7.05 7.03 3 12 3s9 4.05 9 9.044v6.517c0 1.162-.967 2.519-2 2c-.835-.42-2.223-.52-3 0c-.874.585-2.126.585-3 0c-.885-.593-1.649-.57-2.5 0c-.874.585-2.126.585-3 0c-.777-.52-1.665-.42-2.5 0c-1.033.519-2-.838-2-2"/></g>
							</svg>
							<h3 class="text-xl font-semibold text-gray-900 mb-2">{{ isCriminal ? 'Aucun criminel trouvé.' : 'Aucun disparu trouvé.' }}</h3>
							<p class="text-gray-600 mb-6">{{ isCriminal ? 'Aucun criminel pour le moment.' : 'Aucun disparu pour le moment.' }}</p>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
